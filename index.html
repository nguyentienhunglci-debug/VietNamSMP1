<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    
    <!-- PWA Meta Tags cho iOS -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Money Notes">
    <meta name="theme-color" content="#1a1d2e">
    
    <!-- Icon cho app -->
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect width='100' height='100' rx='22' fill='%235b67ca'/><text x='50' y='70' font-size='60' text-anchor='middle' fill='white'>üí∞</text></svg>">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='80' font-size='80'>üí∞</text></svg>">
    
    <title>Money Notes - Qu·∫£n L√Ω & Ghi Ch√∫</title>
    
    <style>
        /* ========== RESET ========== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #1a1d2e 0%, #2d3250 100%);
            color: #fff;
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* ========== CONTAINER ========== */
        .app {
            max-width: 480px;
            margin: 0 auto;
            min-height: 100vh;
            background: #1a1d2e;
            position: relative;
        }

        /* ========== HEADER ========== */
        .header {
            padding: 50px 20px 30px;
            background: linear-gradient(135deg, #5b67ca 0%, #7c4dff 100%);
            text-align: center;
            box-shadow: 0 4px 20px rgba(91, 103, 202, 0.3);
        }

        .greeting {
            font-size: 36px;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .date-display {
            font-size: 16px;
            opacity: 0.9;
            font-weight: 500;
        }

        /* ========== NAVIGATION TABS ========== */
        .nav-tabs {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            position: sticky;
            top: 0;
            z-index: 100;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .nav-tab {
            padding: 16px;
            background: none;
            border: none;
            color: rgba(255, 255, 255, 0.6);
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .nav-tab.active {
            color: #fff;
        }

        .nav-tab.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #5b67ca, #7c4dff);
            border-radius: 3px 3px 0 0;
        }

        /* ========== CONTENT SECTIONS ========== */
        .content {
            display: none;
            padding: 20px;
        }

        .content.active {
            display: block;
        }

        /* ========== QU·∫¢N L√ù TI·ªÄN - STATS ========== */
        .balance-card {
            background: linear-gradient(135deg, #5b67ca 0%, #7c4dff 100%);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 8px 24px rgba(91, 103, 202, 0.4);
            position: relative;
            overflow: hidden;
        }

        .balance-card::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -20%;
            width: 200px;
            height: 200px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
        }

        .balance-label {
            font-size: 14px;
            opacity: 0.9;
            margin-bottom: 8px;
        }

        .balance-amount {
            font-size: 44px;
            font-weight: 700;
            letter-spacing: -1px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 24px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .stat-label {
            font-size: 13px;
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 8px;
        }

        .stat-value {
            font-size: 24px;
            font-weight: 700;
        }

        .expense-color { color: #ff6b6b; }
        .saving-color { color: #51cf66; }

        /* ========== FORM NH·∫¨P LI·ªÜU ========== */
        .section-title {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .type-selector {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 16px;
        }

        .type-btn {
            padding: 14px;
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.05);
            color: rgba(255, 255, 255, 0.7);
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .type-btn.active {
            border-color: #5b67ca;
            background: rgba(91, 103, 202, 0.3);
            color: #fff;
        }

        .form-group {
            margin-bottom: 16px;
        }

        .form-label {
            display: block;
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 8px;
            color: rgba(255, 255, 255, 0.8);
        }

        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.08);
            color: #fff;
            font-size: 16px;
            font-family: inherit;
            transition: all 0.2s ease;
        }

        .form-input:focus {
            outline: none;
            border-color: #5b67ca;
            background: rgba(91, 103, 202, 0.1);
        }

        textarea.form-input {
            resize: vertical;
            min-height: 120px;
            line-height: 1.5;
        }

        .btn-add {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, #5b67ca 0%, #7c4dff 100%);
            border: none;
            border-radius: 12px;
            color: #fff;
            font-size: 17px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 0 4px 16px rgba(91, 103, 202, 0.4);
        }

        .btn-add:active {
            transform: scale(0.98);
        }

        /* ========== DANH S√ÅCH GIAO D·ªäCH / GHI CH√ö ========== */
        .notes-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .note-card {
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 16px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            position: relative;
        }

        .note-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .note-type-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 600;
        }

        .note-type-badge.expense {
            background: rgba(255, 107, 107, 0.2);
            color: #ff6b6b;
        }

        .note-type-badge.saving {
            background: rgba(81, 207, 102, 0.2);
            color: #51cf66;
        }

        .note-amount {
            font-size: 20px;
            font-weight: 700;
        }

        .note-content {
            font-size: 15px;
            line-height: 1.5;
            color: rgba(255, 255, 255, 0.9);
            margin-bottom: 12px;
            white-space: pre-wrap;
        }

        .note-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: 12px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .note-date {
            font-size: 13px;
            color: rgba(255, 255, 255, 0.5);
        }

        .btn-delete {
            background: rgba(255, 107, 107, 0.2);
            border: none;
            padding: 6px 12px;
            border-radius: 6px;
            color: #ff6b6b;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: rgba(255, 255, 255, 0.5);
        }

        .empty-icon {
            font-size: 64px;
            margin-bottom: 16px;
            opacity: 0.5;
        }

        /* ========== GAME T√ÄI X·ªàU ========== */
        .game-container {
            text-align: center;
        }

        .dice-container {
            display: flex;
            justify-content: center;
            gap: 16px;
            margin: 30px 0;
        }

        .dice {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, #fff 0%, #f0f0f0 100%);
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 48px;
            font-weight: 700;
            color: #1a1d2e;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
            animation: rotate 0.5s ease;
        }

        @keyframes rotate {
            0%, 100% { transform: rotate(0deg); }
            50% { transform: rotate(360deg); }
        }

        .total-display {
            font-size: 32px;
            font-weight: 700;
            margin: 20px 0;
            color: #ffd93d;
        }

        .bet-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 20px;
        }

        .bet-btn {
            padding: 20px;
            border: 3px solid rgba(255, 255, 255, 0.2);
            border-radius: 16px;
            background: rgba(255, 255, 255, 0.05);
            color: #fff;
            font-size: 24px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .bet-btn.active {
            border-color: #ffd93d;
            background: rgba(255, 217, 61, 0.2);
            box-shadow: 0 0 20px rgba(255, 217, 61, 0.4);
        }

        .bet-btn.tai { color: #ff6b6b; }
        .bet-btn.xiu { color: #51cf66; }

        .timer {
            font-size: 48px;
            font-weight: 700;
            color: #ffd93d;
            margin: 20px 0;
        }

        .play-btn {
            width: 100%;
            padding: 18px;
            background: linear-gradient(135deg, #ffd93d 0%, #ffab00 100%);
            border: none;
            border-radius: 16px;
            color: #1a1d2e;
            font-size: 20px;
            font-weight: 700;
            cursor: pointer;
            box-shadow: 0 8px 24px rgba(255, 217, 61, 0.4);
            transition: all 0.2s ease;
        }

        .play-btn:active {
            transform: scale(0.98);
        }

        .play-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .result-display {
            margin-top: 20px;
            padding: 16px;
            border-radius: 12px;
            font-size: 18px;
            font-weight: 600;
        }

        .result-display.win {
            background: rgba(81, 207, 102, 0.2);
            color: #51cf66;
        }

        .result-display.lose {
            background: rgba(255, 107, 107, 0.2);
            color: #ff6b6b;
        }

        /* ========== GHI CH√ö ƒê∆†N GI·∫¢N ========== */
        .simple-note-card {
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            margin-bottom: 12px;
        }

        .simple-note-content {
            font-size: 16px;
            line-height: 1.6;
            color: rgba(255, 255, 255, 0.9);
            margin-bottom: 12px;
            white-space: pre-wrap;
        }

        /* ========== RESPONSIVE ========== */
        @media (max-width: 480px) {
            .header {
                padding: 44px 20px 24px;
            }
            .greeting {
                font-size: 32px;
            }
            .balance-amount {
                font-size: 38px;
            }
        }
    </style>
</head>
<body>
    <div class="app">
        <!-- HEADER -->
        <div class="header">
            <div class="greeting">Xin ch√†o! üëã</div>
            <div class="date-display" id="dateDisplay">Th·ª© S√°u, 10 th√°ng 10</div>
        </div>

        <!-- NAVIGATION -->
        <div class="nav-tabs">
            <button class="nav-tab active" onclick="switchTab('money')">üí∞ Qu·∫£n L√Ω Ti·ªÅn</button>
            <button class="nav-tab" onclick="switchTab('notes')">üìù Ghi Ch√∫</button>
            <button class="nav-tab" onclick="switchTab('game')">üé≤ Tr√≤ Ch∆°i</button>
        </div>

        <!-- CONTENT: QU·∫¢N L√ù TI·ªÄN -->
        <div id="moneyContent" class="content active">
            <!-- Stats -->
            <div class="balance-card">
                <div class="balance-label">S·ªë D∆∞ Hi·ªán T·∫°i</div>
                <div class="balance-amount" id="balanceAmount">0ƒë</div>
            </div>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-label">Chi Ti√™u</div>
                    <div class="stat-value expense-color" id="totalExpense">0ƒë</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Ti·∫øt Ki·ªám</div>
                    <div class="stat-value saving-color" id="totalSaving">0ƒë</div>
                </div>
            </div>

            <!-- Form -->
            <div class="section-title">üìù Th√™m Giao D·ªãch</div>
            <form id="moneyForm">
                <div class="type-selector">
                    <button type="button" class="type-btn active" data-type="expense">üí∏ Chi Ti√™u</button>
                    <button type="button" class="type-btn" data-type="saving">üí∞ Ti·∫øt Ki·ªám</button>
                </div>
                <div class="form-group">
                    <label class="form-label">S·ªë Ti·ªÅn (VNƒê)</label>
                    <input type="text" class="form-input" id="moneyAmount" placeholder="0" inputmode="numeric">
                </div>
                <div class="form-group">
                    <label class="form-label">Ghi Ch√∫</label>
                    <textarea class="form-input" id="moneyNote" placeholder="V√≠ d·ª•: Mua n∆∞·ªõc, ƒÉn s√°ng..."></textarea>
                </div>
                <button type="submit" class="btn-add">‚úì Th√™m Giao D·ªãch</button>
            </form>

            <!-- L·ªãch s·ª≠ -->
            <div style="margin-top: 24px;">
                <div class="section-title">üìã L·ªãch S·ª≠ Giao D·ªãch</div>
                <div class="notes-list" id="moneyList"></div>
            </div>
        </div>

        <!-- CONTENT: GHI CH√ö -->
        <div id="notesContent" class="content">
            <div class="section-title">‚úçÔ∏è Ghi Ch√∫ C√° Nh√¢n</div>
            <form id="notesForm">
                <div class="form-group">
                    <textarea class="form-input" id="simpleNote" placeholder="Vi·∫øt ghi ch√∫ c·ªßa b·∫°n...&#x0a;V√≠ d·ª•: H√¥m nay t√¥i ƒëau ch√¢n, nh·ªõ mua thu·ªëc..." rows="6"></textarea>
                </div>
                <button type="submit" class="btn-add">üíæ L∆∞u Ghi Ch√∫</button>
            </form>

            <div style="margin-top: 24px;">
                <div class="section-title">üìö Ghi Ch√∫ ƒê√£ L∆∞u</div>
                <div id="simpleNotesList"></div>
            </div>
        </div>

        <!-- CONTENT: GAME T√ÄI X·ªàU -->
        <div id="gameContent" class="content">
            <div class="game-container">
                <div class="section-title" style="justify-content: center;">üé≤ Tr√≤ Ch∆°i T√†i X·ªâu</div>
                
                <div class="dice-container">
                    <div class="dice" id="dice1">üé≤</div>
                    <div class="dice" id="dice2">üé≤</div>
                    <div class="dice" id="dice3">üé≤</div>
                </div>

                <div class="total-display" id="diceTotal">? ? ?</div>

                <div class="bet-buttons">
                    <button class="bet-btn tai" onclick="selectBet('tai')">
                        <div>üî¥ T√ÄI</div>
                        <div style="font-size: 14px; margin-top: 4px;">11-17</div>
                    </button>
                    <button class="bet-btn xiu" onclick="selectBet('xiu')">
                        <div>üü¢ X·ªàU</div>
                        <div style="font-size: 14px; margin-top: 4px;">4-10</div>
                    </button>
                </div>

                <div class="timer" id="timer">60</div>

                <button class="play-btn" id="playBtn" onclick="startGame()">üéÆ B·∫ÆT ƒê·∫¶U C∆Ø·ª¢C</button>

                <div id="result" class="result-display" style="display: none;"></div>
            </div>
        </div>
    </div>

    <script>
        // ===== BI·∫æN TO√ÄN C·ª§C =====
        let moneyTransactions = [];
        let simpleNotes = [];
        let selectedMoneyType = 'expense';
        let selectedBet = null;
        let gameTimer = null;
        let timeLeft = 60;

        const MONEY_KEY = 'moneyData_v1';
        const NOTES_KEY = 'simpleNotes_v1';

        // ===== LOAD D·ªÆ LI·ªÜU =====
        function loadData() {
            try {
                const money = localStorage.getItem(MONEY_KEY);
                const notes = localStorage.getItem(NOTES_KEY);
                if (money) moneyTransactions = JSON.parse(money);
                if (notes) simpleNotes = JSON.parse(notes);
            } catch (e) {
                console.error('L·ªói load d·ªØ li·ªáu:', e);
            }
        }

        function saveMoneyData() {
            localStorage.setItem(MONEY_KEY, JSON.stringify(moneyTransactions));
        }

        function saveNotesData() {
            localStorage.setItem(NOTES_KEY, JSON.stringify(simpleNotes));
        }

        // ===== ƒê·ªäNH D·∫†NG TI·ªÄN =====
        function formatMoney(amount) {
            return amount.toString().replace(/\B(?=(\d{3})+(?!\d))/g, '.') + 'ƒë';
        }

        function parseMoney(value) {
            return parseInt(value.replace(/\D/g, '')) || 0;
        }

        // ===== X·ª¨ L√ù INPUT S·ªê TI·ªÄN =====
        document.getElementById('moneyAmount').addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            if (value) {
                e.target.value = parseInt(value).toLocaleString('vi-VN');
            } else {
                e.target.value = '';
            }
        });

        // ===== ƒê·ªäNH D·∫†NG TH·ªúI GIAN =====
        function formatDateTime(dateString) {
            const date = new Date(dateString);
            const now = new Date();
            const diff = now - date;
            const minutes = Math.floor(diff / 60000);
            const hours = Math.floor(diff / 3600000);
            const days = Math.floor(diff / 86400000);

            if (minutes < 1) return 'V·ª´a xong';
            if (minutes < 60) return `${minutes} ph√∫t tr∆∞·ªõc`;
            if (hours < 24) return `${hours} gi·ªù tr∆∞·ªõc`;
            if (days === 1) return 'H√¥m qua';
            if (days < 7) return `${days} ng√†y tr∆∞·ªõc`;
            
            return date.toLocaleDateString('vi-VN', {
                day: '2-digit',
                month: '2-digit',
                year: 'numeric'
            });
        }

        // ===== C·∫¨P NH·∫¨T NG√ÄY =====
        function updateDate() {
            const now = new Date();
            const options = { weekday: 'long', day: 'numeric', month: 'long' };
            const dateStr = now.toLocaleDateString('vi-VN', options);
            document.getElementById('dateDisplay').textContent = dateStr.charAt(0).toUpperCase() + dateStr.slice(1);
        }

        // ===== CHUY·ªÇN TAB =====
        function switchTab(tab) {
            document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.content').forEach(c => c.classList.remove('active'));
            
            event.target.classList.add('active');
            
            if (tab === 'money') {
                document.getElementById('moneyContent').classList.add('active');
            } else if (tab === 'notes') {
                document.getElementById('notesContent').classList.add('active');
            } else if (tab === 'game') {
                document.getElementById('gameContent').classList.add('active');
            }
        }

        // ===== QU·∫¢N L√ù TI·ªÄN =====
        function updateMoneyStats() {
            let expense = 0, saving = 0;
            moneyTransactions.forEach(t => {
                if (t.type === 'expense') expense += t.amount;
                else saving += t.amount;
            });
            const balance = saving - expense;
            
            document.getElementById('totalExpense').textContent = formatMoney(expense);
            document.getElementById('totalSaving').textContent = formatMoney(saving);
            document.getElementById('balanceAmount').textContent = formatMoney(balance);
        }

        function displayMoneyList() {
            const list = document.getElementById('moneyList');
            if (moneyTransactions.length === 0) {
                list.innerHTML = '<div class="empty-state"><div class="empty-icon">üí∏</div><p>Ch∆∞a c√≥ giao d·ªãch n√†o</p></div>';
                return;
            }
            
            const sorted = [...moneyTransactions].sort((a, b) => new Date(b.date) - new Date(a.date));
            list.innerHTML = sorted.map(t => `
                <div class="note-card">
                    <div class="note-header">
                        <span class="note-type-badge ${t.type}">
                            ${t.type === 'expense' ? 'üí∏ Chi Ti√™u' : 'üí∞ Ti·∫øt Ki·ªám'}
                        </span>
                        <div class="note-amount ${t.type === 'expense' ? 'expense-color' : 'saving-color'}">
                            ${t.type === 'expense' ? '-' : '+'}${formatMoney(t.amount)}
                        </div>
                    </div>
                    ${t.note ? `<div class="note-content">${t.note}</div>` : ''}
                    <div class="note-footer">
                        <div class="note-date">${formatDateTime(t.date)}</div>
                        <button class="btn-delete" onclick="deleteMoneyTransaction(${t.id})">X√≥a</button>
                    </div>
                </div>
            `).join('');
        }

        document.querySelectorAll('.type-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('.type-btn').forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                selectedMoneyType = this.dataset.type;
            });
        });

        document.getElementById('moneyForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const amount = parseMoney(document.getElementById('moneyAmount').value);
            const note = document.getElementById('moneyNote').value.trim();
            
            if (amount <= 0) {
                alert('Vui l√≤ng nh·∫≠p s·ªë ti·ªÅn h·ª£p l·ªá');
                return;
            }
            
            moneyTransactions.push({
                id: Date.now(),
                type: selectedMoneyType,
                amount: amount,
                note: note,
                date: new Date().toISOString()
            });
            
            saveMoneyData();
            updateMoneyStats();
            displayMoneyList();
            
            document.getElementById('moneyAmount').value = '';
            document.getElementById('moneyNote').value = '';
        });

        function deleteMoneyTransaction(id) {
            if (confirm('X√≥a giao d·ªãch n√†y?')) {
                moneyTransactions = moneyTransactions.filter(t => t.id !== id);
                saveMoneyData();
                updateMoneyStats();
                displayMoneyList();
            }
        }

        // ===== GHI CH√ö ƒê∆†N GI·∫¢N =====
        function displaySimpleNotes() {
            const list = document.getElementById('simpleNotesList');
            if (simpleNotes.length === 0) {
                list.innerHTML = '<div class="empty-state"><div class="empty-icon">üìù</div><p>Ch∆∞a c√≥ ghi ch√∫ n√†o</p></div>';
                return;
            }
            
            const sorted = [...simpleNotes].sort((a, b) => new Date(b.date) - new Date(a.date));
            list.innerHTML = sorted.map(note => `