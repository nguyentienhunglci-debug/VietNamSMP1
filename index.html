<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Qu·∫£n L√Ω T√†i Ch√≠nh</title>
    
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <link rel="manifest" href="manifest.webmanifest">
    <link rel="apple-touch-icon" href="icon-192x192.png">

    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, sans-serif; background: #F2F2F7; padding-bottom: 80px; }
        .screen { display: none; }
        .screen.active { display: block; }
        .header { background: #FFF; padding: 20px; border-bottom: 1px solid #E5E5E5; }
        .header h1 { font-size: 28px; font-weight: 700; }
        .btn { padding: 14px 20px; border: none; border-radius: 10px; font-size: 16px; font-weight: 600; cursor: pointer; background: #007AFF; color: white; width: 100%; margin-top: 12px; }
        .btn:active { opacity: 0.7; }
        .btn-sec { background: #E5E5EA; color: #000; }
        .btn-danger { background: #FF3B30; }
        .btn-success { background: #34C759; }
        .btn-warning { background: #FF9500; }
        .stat-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; padding: 20px; }
        .stat-card { background: #FFF; padding: 20px; border-radius: 12px; text-align: center; }
        .stat-label { color: #8E8E93; font-size: 13px; margin-bottom: 8px; }
        .stat-value { font-size: 24px; font-weight: 600; }
        .stat-value.red { color: #FF3B30; }
        .stat-value.green { color: #34C759; }
        .card { background: #FFF; border-radius: 12px; padding: 16px; margin: 16px 20px; }
        .txn-item { display: flex; align-items: center; padding: 12px; background: #F9F9F9; border-radius: 8px; margin-bottom: 8px; }
        .txn-icon { width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 20px; margin-right: 12px; }
        .txn-icon.exp { background: #FFE5E5; }
        .txn-icon.inc { background: #E5F8E5; }
        .txn-icon.sav { background: #FFF5E5; }
        .txn-info { flex: 1; }
        .txn-cat { font-weight: 600; font-size: 15px; }
        .txn-date { color: #8E8E93; font-size: 13px; }
        .txn-amt { font-weight: 600; font-size: 16px; }
        .txn-acts { display: flex; gap: 8px; margin-left: 8px; }
        .icon-btn { width: 36px; height: 36px; border: none; background: #FFF; border-radius: 8px; cursor: pointer; font-size: 16px; }
        .icon-btn:active { opacity: 0.5; }
        .bottom-nav { position: fixed; bottom: 0; left: 0; right: 0; background: #FFF; border-top: 1px solid #E5E5E5; display: flex; padding: 8px 0; }
        .nav-item { flex: 1; text-align: center; padding: 8px; cursor: pointer; color: #8E8E93; }
        .nav-item.active { color: #007AFF; }
        .nav-item:active { opacity: 0.5; }
        .nav-icon { font-size: 24px; }
        .nav-label { font-size: 11px; }
        .modal { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center; }
        .modal.show { display: flex; }
        .modal-content { background: #FFF; border-radius: 16px; padding: 24px; width: 90%; max-width: 400px; max-height: 80vh; overflow-y: auto; }
        .modal-title { font-size: 20px; font-weight: 600; margin-bottom: 16px; }
        .form-group { margin-bottom: 16px; }
        .form-label { display: block; color: #8E8E93; font-size: 13px; margin-bottom: 6px; }
        .form-input, .form-select, .form-textarea { width: 100%; padding: 12px; border: 1px solid #E5E5E5; border-radius: 8px; font-size: 16px; background: #F9F9F9; }
        .form-textarea { min-height: 100px; font-family: inherit; }
        .modal-actions { display: flex; gap: 12px; margin-top: 20px; }
        .empty { text-align: center; padding: 40px 20px; color: #8E8E93; }
        .note-item { background: #F9F9F9; padding: 16px; border-radius: 12px; margin-bottom: 12px; cursor: pointer; }
        .note-item:active { opacity: 0.7; }
        .note-title { font-weight: 600; margin-bottom: 8px; }
        .note-preview { color: #8E8E93; font-size: 14px; }
        .type-buttons { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 12px; margin-top: 20px; }

        /* --- CSS M·ªöI --- */
        .quick-add-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 10px;
            margin-top: 12px;
        }
        .quick-add-btn {
            padding: 12px 0;
            border: 1px solid #E5E5E5;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            background: #F9F9F9;
            color: #007AFF;
        }
        .quick-add-btn:active {
            background: #E5E5EA;
        }
        /* --- K·∫æT TH√öC CSS M·ªöI --- */
    </style>
</head>
<body>

<div id="dash" class="screen active">
    <div class="header">
        <h1>T√†i Ch√≠nh</h1>
        <p id="currentDate" style="color: #8E8E93; font-size: 14px; margin-top: 4px;"></p>
        <div class="type-buttons">
            <button class="btn btn-danger" onclick="openTxn('expense')">üí∏ Chi Ti√™u</button>
            <button class="btn btn-success" onclick="openTxn('income')">üí∞ Thu Nh·∫≠p</button>
            <button class="btn btn-warning" onclick="openTxn('savings')">üè¶ Ti·∫øt Ki·ªám</button>
        </div>
    </div>
    <div class="stat-grid">
        <div class="stat-card">
            <div class="stat-label">T·ªïng S·ªë D∆∞</div>
            <div class="stat-value" id="bal">0‚Ç´</div>
        </div>
        <div class="stat-card">
            <div class="stat-label">ƒê√£ Chi</div>
            <div class="stat-value red" id="exp">0‚Ç´</div>
        </div>
        <div class="stat-card">
            <div class="stat-label">Thu Nh·∫≠p</div>
            <div class="stat-value green" id="inc">0‚Ç´</div>
        </div>
        <div class="stat-card">
            <div class="stat-label">Ti·∫øt Ki·ªám</div>
            <div class="stat-value" id="sav">0‚Ç´</div>
        </div>
    </div>
    <div class="card">
        <h3 style="margin-bottom: 16px;">Giao D·ªãch G·∫ßn ƒê√¢y</h3>
        <div id="recent"></div>
    </div>
</div>

<div id="hist" class="screen">
    <div class="header"><h1>L·ªãch S·ª≠</h1></div>
    <div class="card">
        <input type="text" class="form-input" placeholder="üîç T√¨m ki·∫øm..." id="search" oninput="doSearch()">
    </div>
    <div class="card"><div id="histList"></div></div>
</div>

<div id="notes" class="screen">
    <div class="header">
        <h1>Ghi Ch√∫</h1>
        <button class="btn" onclick="openNote()">+ T·∫°o Ghi Ch√∫</button>
    </div>
    <div class="card"><div id="notesList"></div></div>
</div>

<div id="reports" class="screen">
    <div class="header"><h1>B√°o C√°o</h1></div>
    <div class="card">
        <h3>T·ªïng Quan</h3>
        <div id="rpt" style="margin-top: 16px;"></div>
    </div>
    <div class="card">
        <h3>C√†i ƒë·∫∑t</h3>
        <button class="btn btn-danger" onclick="resetData()">X√≥a To√†n B·ªô D·ªØ Li·ªáu</button>
    </div>
</div>

<div class="bottom-nav">
    <div class="nav-item active" onclick="goTo('dash', this)">
        <div class="nav-icon">üè†</div>
        <div class="nav-label">T·ªïng Quan</div>
    </div>
    <div class="nav-item" onclick="goTo('hist', this)">
        <div class="nav-icon">üìä</div>
        <div class="nav-label">L·ªãch S·ª≠</div>
    </div>
    <div class="nav-item" onclick="goTo('notes', this)">
        <div class="nav-icon">üìù</div>
        <div class="nav-label">Ghi Ch√∫</div>
    </div>
    <div class="nav-item" onclick="goTo('reports', this)">
        <div class="nav-icon">üìà</div>
        <div class="nav-label">B√°o C√°o</div>
    </div>
</div>

<div id="txnModal" class="modal">
    <div class="modal-content">
        <h2 class="modal-title" id="modalTitle">Th√™m Giao D·ªãch</h2>
        <div class="form-group">
            <label class="form-label">S·ªë ti·ªÅn (‚Ç´)</label>
            <input type="number" class="form-input" id="amt" placeholder="50000" inputmode="numeric">
            
            <div class="quick-add-grid">
                <button type="button" class="quick-add-btn" onclick="addAmount(10000)">10K</button>
                <button type="button" class="quick-add-btn" onclick="addAmount(50000)">50K</button>
                <button type="button" class="quick-add-btn" onclick="addAmount(100000)">100K</button>
                <button type="button" class="quick-add-btn" onclick="addAmount(500000)">500K</button>
                <button type="button" class="quick-add-btn btn-sec" onclick="clearAmount()">X√≥a</button>
            </div>
            </div>
        <div class="form-group">
            <label class="form-label">Danh m·ª•c</label>
            <select class="form-select" id="cat">
                <option value="food">üçî ƒÇn u·ªëng</option>
                <option value="transport">üöó ƒêi l·∫°i</option>
                <option value="shopping">üõçÔ∏è Mua s·∫Øm</option>
                <option value="bills">üí° H√≥a ƒë∆°n</option>
                <option value="salary">üí∞ L∆∞∆°ng</option>
                <option value="other">üìå Kh√°c</option>
            </select>
        </div>
        <div class="form-group">
            <label class="form-label">Ghi ch√∫</label>
            <textarea class="form-textarea" id="note" placeholder="Nh·∫≠p ghi ch√∫..."></textarea>
        </div>
        <input type="hidden" id="type">
        <input type="hidden" id="editId">
        <div class="modal-actions">
            <button class="btn btn-sec" onclick="closeModal('txnModal')" style="flex:1">H·ªßy</button>
            <button class="btn" onclick="saveTxn()" style="flex:1">L∆∞u</button>
        </div>
    </div>
</div>

<div id="noteModal" class="modal">
    <div class="modal-content">
        <h2 class="modal-title">Ghi Ch√∫</h2>
        <div class="form-group">
            <label class="form-label">Ti√™u ƒë·ªÅ</label>
            <input type="text" class="form-input" id="noteTitle">
        </div>
        <div class="form-group">
            <label class="form-label">N·ªôi dung</label>
            <textarea class="form-textarea" id="noteContent" style="min-height:200px"></textarea>
        </div>
        <input type="hidden" id="editNoteId">
        <div class="modal-actions">
            <button class="btn btn-sec" onclick="closeModal('noteModal')" style="flex:1">H·ªßy</button>
            <button class="btn" onclick="saveNote()" style="flex:1">L∆∞u</button>
        </div>
    </div>
</div>

<script>
const KEY = 'mywallet_v1';
let db = { txns: [], notes: [] };

function load() {
    try {
        const s = localStorage.getItem(KEY);
        if (s) db = JSON.parse(s);
    } catch(e) {}
}

function save() {
    localStorage.setItem(KEY, JSON.stringify(db));
}

function fmt(n) {
    return new Intl.NumberFormat('vi-VN').format(n) + '‚Ç´';
}

function displayDate() {
    const today = new Date();
    const options = { weekday: 'long', day: 'numeric', month: 'numeric', year: 'numeric' };
    const dateString = today.toLocaleDateString('vi-VN', options);
    const capitalizedDateString = dateString.charAt(0).toUpperCase() + dateString.slice(1);
    document.getElementById('currentDate').textContent = `H√¥m nay, ${capitalizedDateString}`;
}

function init() {
    load();
    displayDate();
    render();
}

function render() {
    renderDash();
    renderHist();
    renderNotes();
    renderRpt();
}

function renderDash() {
    let bal = 0, exp = 0, inc = 0, sav = 0;
    db.txns.forEach(t => {
        if (t.type === 'expense') exp += t.amount;
        else if (t.type === 'income') inc += t.amount;
        else if (t.type === 'savings') sav += t.amount;
    });
    bal = inc - exp;
    
    document.getElementById('bal').textContent = fmt(bal);
    document.getElementById('exp').textContent = fmt(exp);
    document.getElementById('inc').textContent = fmt(inc);
    document.getElementById('sav').textContent = fmt(sav);
    
    const recent = db.txns.slice().reverse().slice(0, 3);
    document.getElementById('recent').innerHTML = recent.length > 0 ? recent.map(t => makeTxn(t, false)).join('') : '<div class="empty">Ch∆∞a c√≥ giao d·ªãch n√†o<br>H√£y th√™m giao d·ªãch ƒë·∫ßu ti√™n! üéâ</div>';
}

function renderHist() {
    const allTxns = db.txns.slice().reverse();
    document.getElementById('histList').innerHTML = allTxns.length > 0 ? allTxns.map(t => makeTxn(t, true)).join('') : '<div class="empty">Ch∆∞a c√≥ giao d·ªãch</div>';
}

function makeTxn(t, acts) {
    const icons = { food: 'üçî', transport: 'üöó', shopping: 'üõçÔ∏è', bills: 'üí°', salary: 'üí∞', other: 'üìå' };
    const names = { food: 'ƒÇn u·ªëng', transport: 'ƒêi l·∫°i', shopping: 'Mua s·∫Øm', bills: 'H√≥a ƒë∆°n', salary: 'L∆∞∆°ng', other: 'Kh√°c' };
    const ic = icons[t.cat] || 'üìå';
    const nm = names[t.cat] || 'Kh√°c';
    const dt = new Date(t.date).toLocaleDateString('vi-VN');
    const cls = t.type === 'expense' ? 'exp' : (t.type === 'income' ? 'inc' : 'sav');
    const amtSign = t.type === 'expense' ? '-' : '+';
    const amtColor = t.type === 'expense' ? 'red' : 'green';
    
    const btns = acts ? `<div class="txn-acts"><button class="icon-btn" onclick="editTxn(${t.id})">‚úèÔ∏è</button><button class="icon-btn" onclick="delTxn(${t.id})">üóëÔ∏è</button></div>` : '';
    
    return `<div class="txn-item">
        <div class="txn-icon ${cls}">${ic}</div>
        <div class="txn-info">
            <div class="txn-cat">${nm}</div>
            <div class="txn-date">${dt}</div>
        </div>
        <div class="txn-amt" style="color:${amtColor}">${amtSign}${fmt(t.amount)}</div>
        ${btns}
    </div>`;
}

function renderNotes() {
    const allNotes = db.notes.slice().reverse();
    document.getElementById('notesList').innerHTML = allNotes.length > 0 ? allNotes.map(n => `<div class="note-item" onclick="editNote(${n.id})"><div class="note-title">${n.title}</div><div class="note-preview">${n.content.substring(0,100)}...</div></div>`).join('') : '<div class="empty">Ch∆∞a c√≥ ghi ch√∫</div>';
}

function renderRpt() {
    let exp = 0, inc = 0;
    db.txns.forEach(t => {
        if (t.type === 'expense') exp += t.amount;
        else if (t.type === 'income') inc += t.amount;
    });
    document.getElementById('rpt').innerHTML = `
        <div style="padding:12px;background:#F9F9F9;border-radius:8px;margin-bottom:12px">
            <div style="color:#8E8E93;font-size:13px">T·ªïng Chi</div>
            <div style="font-size:20px;font-weight:600;color:#FF3B30">${fmt(exp)}</div>
        </div>
        <div style="padding:12px;background:#F9F9F9;border-radius:8px">
            <div style="color:#8E8E93;font-size:13px">T·ªïng Thu</div>
            <div style="font-size:20px;font-weight:600;color:#34C759">${fmt(inc)}</div>
        </div>
    `;
}

function goTo(scr, element) {
    document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
    document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
    document.getElementById(scr).classList.add('active');
    element.classList.add('active');
}

function openTxn(txnType) {
    document.getElementById('editId').value = '';
    document.getElementById('type').value = txnType;
    document.getElementById('amt').value = '';
    document.getElementById('cat').value = 'food';
    document.getElementById('note').value = '';
    
    const titles = {
        'expense': 'üí∏ Th√™m Chi Ti√™u',
        'income': 'üí∞ Th√™m Thu Nh·∫≠p',
        'savings': 'üè¶ Th√™m Ti·∫øt Ki·ªám'
    };
    document.getElementById('modalTitle').textContent = titles[txnType];
    
    document.getElementById('txnModal').classList.add('show');
}

function saveTxn() {
    const id = document.getElementById('editId').value;
    const amt = parseInt(document.getElementById('amt').value) || 0;
    
    if (amt <= 0) {
        alert('Vui l√≤ng nh·∫≠p s·ªë ti·ªÅn h·ª£p l·ªá!');
        return;
    }
    
    const txn = {
        id: id ? parseInt(id) : Date.now(),
        type: document.getElementById('type').value,
        amount: amt,
        cat: document.getElementById('cat').value,
        note: document.getElementById('note').value,
        date: id ? db.txns.find(t=>t.id === parseInt(id)).date : new Date().toISOString()
    };
    
    if (id) {
        const idx = db.txns.findIndex(t => t.id === parseInt(id));
        if (idx > -1) db.txns[idx] = txn;
    } else {
        db.txns.push(txn);
    }
    
    save();
    closeModal('txnModal');
    render();
}

function editTxn(id) {
    const t = db.txns.find(x => x.id === id);
    if (!t) return;
    
    document.getElementById('editId').value = t.id;
    document.getElementById('type').value = t.type;
    document.getElementById('amt').value = t.amount;
    document.getElementById('cat').value = t.cat;
    document.getElementById('note').value = t.note;
    
    const titles = {
        'expense': 'üí∏ S·ª≠a Chi Ti√™u',
        'income': 'üí∞ S·ª≠a Thu Nh·∫≠p',
        'savings': 'üè¶ S·ª≠a Ti·∫øt Ki·ªám'
    };
    document.getElementById('modalTitle').textContent = titles[t.type];
    
    document.getElementById('txnModal').classList.add('show');
}

function delTxn(id) {
    if (confirm('X√≥a giao d·ªãch n√†y?')) {
        db.txns = db.txns.filter(t => t.id !== id);
        save();
        render();
    }
}

function openNote() {
    document.getElementById('editNoteId').value = '';
    document.getElementById('noteTitle').value = '';
    document.getElementById('noteContent').value = '';
    document.getElementById('noteModal').classList.add('show');
}

function saveNote() {
    const title = document.getElementById('noteTitle').value.trim();
    const content = document.getElementById('noteContent').value.trim();
    
    if (!title) {
        alert('Vui l√≤ng nh·∫≠p ti√™u ƒë·ªÅ!');
        return;
    }
    
    const id = document.getElementById('editNoteId').value;
    const n = {
        id: id ? parseInt(id) : Date.now(),
        title: title,
        content: content,
        date: id ? db.notes.find(x => x.id === parseInt(id)).date : new Date().toISOString()
    };
    
    if (id) {
        const idx = db.notes.findIndex(x => x.id === parseInt(id));
        if (idx > -1) db.notes[idx] = n;
    } else {
        db.notes.push(n);
    }
    
    save();
    closeModal('noteModal');
    render();
}

function editNote(id) {
    const n = db.notes.find(x => x.id === id);
    if (!n) return;
    document.getElementById('editNoteId').value = n.id;
    document.getElementById('noteTitle').value = n.title;
    document.getElementById('noteContent').value = n.content;
    document.getElementById('noteModal').classList.add('show');
}

function closeModal(id) {
    document.getElementById(id).classList.remove('show');
}

// --- H√ÄM JAVASCRIPT M·ªöI ---
function addAmount(value) {
    const amtInput = document.getElementById('amt');
    let currentAmount = parseInt(amtInput.value) || 0;
    currentAmount += value;
    amtInput.value = currentAmount;
}

function clearAmount() {
    document.getElementById('amt').value = '';
}
// --- K·∫æT TH√öC H√ÄM JAVASCRIPT M·ªöI ---

function doSearch() {
    const q = document.getElementById('search').value.toLowerCase();
    const allTxns = db.txns.slice().reverse();
    const res = allTxns.filter(t => {
        const noteMatch = t.note.toLowerCase().includes(q);
        const names = { food: 'ƒÇn u·ªëng', transport: 'ƒêi l·∫°i', shopping: 'Mua s·∫Øm', bills: 'H√≥a ƒë∆°n', salary: 'L∆∞∆°ng', other: 'Kh√°c' };
        const catName = (names[t.cat] || 'Kh√°c').toLowerCase();
        const catMatch = catName.includes(q);
        const amountMatch = t.amount.toString().includes(q);
        return noteMatch || catMatch || amountMatch;
    });
    document.getElementById('histList').innerHTML = res.length > 0 ? res.map(t => makeTxn(t, true)).join('') : '<div class="empty">Kh√¥ng t√¨m th·∫•y</div>';
}

function resetData() {
    if (confirm('‚ö†Ô∏è B·∫†N C√ì CH·∫ÆC CH·∫ÆN MU·ªêN X√ìA TO√ÄN B·ªò D·ªÆ LI·ªÜU KH√îNG?\nH√†nh ƒë·ªông n√†y kh√¥ng th·ªÉ ho√†n t√°c!')) {
        db = { txns: [], notes: [] }; 
        save();
        render(); 
        alert('‚úÖ ƒê√£ x√≥a to√†n b·ªô d·ªØ li·ªáu.');
    }
}

init();
</script>
</body>
</html>
